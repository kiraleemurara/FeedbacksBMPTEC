<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>P√°gina Inicial</title>
  <link rel="stylesheet" href="../css/styles.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body>

  <!-- Barra Superior com Menu de Navega√ß√£o -->
  <header>
    <nav>
      <a href="/">üè† In√≠cio</a>
      <a id="link-questionario" href="/questionario">üìù Auto-Avalia√ß√£o</a>
      <a id="metas-anuais" href="/metasAnuais">üìù Metas</a>
    </nav>
  </header>

  <!-- T√≠tulo da P√°gina -->
  <main>
    <h1>Feedback BMPTEC</h1>
    <h2>Arquivos Gerados</h2>
    <!-- Menu op√ß√µes arquivos-->
    <div>
      <a href="/compactar" id="baixar-zip" class="btn-menu">
        <i class="fa fa-file"></i> Baixar arquivos compactados
      </a>
      <button id="excluir-arquivos" class="btn-menu">Excluir Todos os Arquivos</button>
    </div>
    <!-- Inicio grid-->
    <table>
      <thead>
        <tr>
          <th>Nome Arquivo</th>
          <th>Squad</th>
          <th>Data Arquivo</th>
          <th>A√ß√£o</th>
        </tr>
      </thead>
      <tbody id="arquivos-tabela">
        <!-- Os dados dos arquivos ser√£o inseridos aqui -->
      </tbody>
    </table>
  </main>

  <!-- Script para carregar os dados -->
  <script>
    // Fun√ß√£o para carregar os arquivos gerados hoje e exibi-los na tabela
    function carregarArquivos() {
      fetch('/api/arquivos') // Supondo que sua API esteja em /api/arquivos
        .then(response => response.json())
        .then(arquivos => {
          const tabela = document.getElementById('arquivos-tabela');
          tabela.innerHTML = ''; // Limpa a tabela

          arquivos.forEach(arquivo => {
            const tr = document.createElement('tr');
            
            const tdNome = document.createElement('td');
            tdNome.textContent = arquivo.nome;
            
            const tdSquad = document.createElement('td');
            tdSquad.textContent = arquivo.squad;
            
            const tdDataHora = document.createElement('td');
            tdDataHora.textContent = arquivo.dataHora; // Exibe a data e hora

            const tdAcao = document.createElement('td');
            const downloadLink = document.createElement('a');
            downloadLink.href = arquivo.downloadUrl; // Link de download
            downloadLink.setAttribute('download', arquivo.nome); // Sugest√£o de nome para o arquivo
            
            // Adiciona o √≠cone de download (seta para baixo)
            const downloadIcon = document.createElement('i');
            downloadIcon.classList.add('fas', 'fa-download'); // √çcone do FontAwesome
            downloadLink.appendChild(downloadIcon);

            tdAcao.appendChild(downloadLink);

            tr.appendChild(tdNome);
            tr.appendChild(tdSquad);
            tr.appendChild(tdDataHora);
            tr.appendChild(tdAcao);

            tabela.appendChild(tr);
          });
        })
        .catch(error => console.error('Erro ao carregar arquivos:', error));
    }
    
    // Fun√ß√£o para chamar o endpoint de exclus√£o de arquivos
    document.getElementById('excluir-arquivos').addEventListener('click', () => {
      if (confirm("Tem certeza que deseja excluir todos os arquivos?")) {
        fetch('/excluirArquivos', {  
          method: 'DELETE',  // M√©todo DELETE
        })
        .then(response => response.json())
        .then(data => {
          alert(data.message); // Exibe a mensagem de sucesso ou erro
        })
        .catch(error => {
          console.error('Erro ao excluir arquivos:', error);
          alert('Ocorreu um erro ao tentar excluir os arquivos.');
        });
      }
    });



    // Carregar os arquivos quando a p√°gina for carregada
    window.onload = carregarArquivos;

  </script>


</body>
</html>
